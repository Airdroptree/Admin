<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>एयरड्रॉप कॉन्ट्रैक्ट एडमिन पैनल</title>
    
    <!-- CSP Meta Tag for Netlify -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self' https: 'unsafe-inline' 'unsafe-eval' data: blob:;
        script-src 'self' 'unsafe-inline' 'unsafe-eval' https:;
        style-src 'self' 'unsafe-inline' https:;
        connect-src 'self' https: wss:;
    ">
    
    <!-- Ethers from CDNJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 25px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
        }

        .wallet-section {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
        }

        .wallet-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #219a52;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .btn-warning:hover {
            background: #d35400;
            transform: translateY(-2px);
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn-info:hover {
            background: #138496;
            transform: translateY(-2px);
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 25px;
        }

        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border: 1px solid #e1e8ed;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #3498db;
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
            display: block;
        }

        .info-box {
            background: #e8f4fd;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .info-box h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #3498db;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .decimals-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 8px;
            margin-top: 5px;
            font-size: 0.8em;
            color: #856404;
        }

        .current-value {
            background: #e8f5e8;
            border: 1px solid #c8e6c9;
            border-radius: 5px;
            padding: 8px;
            margin-top: 5px;
            font-size: 0.8em;
            color: #2e7d32;
        }

        .balance-info {
            background: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .balance-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .balance-row:last-child {
            margin-bottom: 0;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .debug-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
        }

        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background: #f8f9fa;
        }

        .test-success {
            border-left: 4px solid #28a745;
            background: #d4edda;
        }

        .test-error {
            border-left: 4px solid #dc3545;
            background: #f8d7da;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>एयरड्रॉप कॉन्ट्रैक्ट एडमिन पैनल</h1>
            <p>BSC USDT (18 Decimals) के लिए ऑप्टिमाइज्ड</p>
        </div>

        <div class="wallet-section">
            <div class="wallet-info">
                <div>
                    <strong>वॉलेट पता:</strong> 
                    <span id="walletAddress">कनेक्ट नहीं किया गया</span>
                </div>
                <div>
                    <strong>नेटवर्क:</strong> 
                    <span id="networkInfo">अज्ञात</span>
                </div>
                <button class="btn btn-primary" id="connectBtn">
                    वॉलेट कनेक्ट करें
                </button>
            </div>
        </div>

        <div class="content">
            <!-- बाएं कॉलम -->
            <div class="left-column">
                <!-- कॉन्ट्रैक्ट स्टेटस -->
                <div class="card">
                    <h3>कॉन्ट्रैक्ट स्टेटस</h3>
                    
                    <div class="info-box">
                        <h4>Debug Information</h4>
                        <div><strong>Contract Address:</strong> <span id="debugContractAddress">-</span></div>
                        <div><strong>Network:</strong> <span id="debugNetwork">-</span></div>
                        <div><strong>Connected Wallet:</strong> <span id="debugWallet">-</span></div>
                        <div><strong>Contract Owner:</strong> <span id="debugOwner">-</span></div>
                    </div>

                    <div class="balance-info">
                        <div class="balance-row">
                            <span>कॉन्ट्रैक्ट टोकन बैलेंस:</span>
                            <strong id="contractBalance">0</strong>
                        </div>
                        <div class="balance-row">
                            <span>आपका टोकन बैलेंस:</span>
                            <strong id="userTokenBalance">0</strong>
                        </div>
                        <div class="balance-row">
                            <span>कॉन्ट्रैक्ट BNB बैलेंस:</span>
                            <strong id="contractBNBBalance">0</strong>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" id="loadStatsBtn" style="width: 100%;">
                        स्टेटस अपडेट करें
                    </button>
                </div>

                <!-- Basic Functions -->
                <div class="card">
                    <h3>बेसिक फंक्शन्स टेस्ट</h3>
                    
                    <div class="form-group">
                        <label>कॉन्ट्रैक्ट ओनर:</label>
                        <div class="current-value" id="basicOwner">लोड हो रहा है...</div>
                        <button class="btn btn-info" id="ownerBtn" style="margin-top: 10px; width: 100%;">
                            ओनर चेक करें
                        </button>
                    </div>

                    <div class="form-group">
                        <label>कॉन्ट्रैक्ट पॉज्ड:</label>
                        <div class="current-value" id="basicPaused">लोड हो रहा है...</div>
                        <button class="btn btn-info" id="pausedBtn" style="margin-top: 10px; width: 100%;">
                            पॉज स्टेटस चेक करें
                        </button>
                    </div>

                    <div class="form-group">
                        <label>टोकन एड्रेस:</label>
                        <div class="current-value" id="basicToken">लोड हो रहा है...</div>
                        <button class="btn btn-info" id="tokenBtn" style="margin-top: 10px; width: 100%;">
                            टोकन एड्रेस चेक करें
                        </button>
                    </div>
                </div>
            </div>

            <!-- दाएं कॉलम -->
            <div class="right-column">
                <!-- Debug Information -->
                <div class="card">
                    <h3>कॉन्ट्रैक्ट टेस्टिंग</h3>
                    
                    <div class="info-box">
                        <h4>Available Functions Test</h4>
                        <p>यहाँ बेसिक फंक्शन्स टेस्ट कर सकते हैं जो कॉन्ट्रैक्ट में available हैं:</p>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                            <button class="btn btn-warning" id="testAllBtn">
                                सभी फंक्शन्स टेस्ट करें
                            </button>
                            <button class="btn btn-danger" id="resetBtn">
                                UI रीसेट करें
                            </button>
                        </div>
                    </div>

                    <div id="testResults">
                        <!-- Test results will appear here -->
                    </div>

                    <div class="debug-info">
                        <strong>Last Error:</strong>
                        <div id="lastError">कोई एरर नहीं</div>
                    </div>
                </div>

                <!-- अन्य सेक्शन्स -->
                <div class="card">
                    <h3>अन्य फंक्शन्स</h3>
                    <div class="info-box">
                        <p>एक बार बेसिक कनेक्शन काम करने के बाद ये फंक्शन्स enable होंगे।</p>
                    </div>
                    
                    <button class="btn btn-success" id="depositBtn" style="width: 100%; margin-bottom: 10px;">
                        डिपॉजिट टोकन
                    </button>
                    <button class="btn btn-success" id="withdrawBtn" style="width: 100%; margin-bottom: 10px;">
                        टोकन निकालें
                    </button>
                    <button class="btn btn-success" id="settingsBtn" style="width: 100%;">
                        सेटिंग्स बदलें
                    </button>
                </div>
            </div>
        </div>

        <!-- स्टेटस मैसेज -->
        <div id="statusMessage" class="status"></div>
    </div>

    <script>
        // Global variables
        let provider;
        let signer;
        let contract;
        let userAddress;

        // कॉन्ट्रैक्ट एड्रेस
        const CONTRACT_ADDRESS = "0x438a33ac022b837f499449e64c07491466edc0bc";
        
        // Simplified ABI - केवल basic functions
        const CONTRACT_ABI = [
            // Basic view functions
            "function owner() external view returns (address)",
            "function paused() external view returns (bool)",
            "function token() external view returns (address)",
            "function usdt() external view returns (address)",
            "function minUSDT() external view returns (uint256)",
            "function maxAirdropPerClaim() external view returns (uint256)",
            "function totalAirdropCap() external view returns (uint256)",
            "function totalDistributed() external view returns (uint256)",
            "function withdrawDelay() external view returns (uint256)"
        ];

        console.log('Ethers loaded:', typeof ethers !== 'undefined');

        // वॉलेट कनेक्ट करें
        async function connectWallet() {
            try {
                if (typeof ethers === 'undefined') {
                    showStatus("Ethers library लोड नहीं हो पाई। पेज refresh करें।", "error");
                    return;
                }

                if (window.ethereum) {
                    const connectBtn = document.getElementById('connectBtn');
                    connectBtn.innerHTML = '<span class="loading"></span> कनेक्ट हो रहा है...';
                    connectBtn.disabled = true;
                    
                    showStatus("MetaMask कनेक्ट किया जा रहा है...", "success");
                    
                    // Accounts request
                    const accounts = await window.ethereum.request({ 
                        method: 'eth_requestAccounts' 
                    });
                    
                    // Provider create करें
                    provider = new ethers.providers.Web3Provider(window.ethereum);
                    signer = provider.getSigner();
                    userAddress = await signer.getAddress();
                    
                    // Debug info update
                    document.getElementById('debugContractAddress').textContent = CONTRACT_ADDRESS;
                    document.getElementById('debugWallet').textContent = userAddress;
                    
                    // Network info
                    const network = await provider.getNetwork();
                    const networkName = getNetworkName(network.chainId);
                    document.getElementById('networkInfo').textContent = `${networkName} (${network.chainId})`;
                    document.getElementById('debugNetwork').textContent = `${networkName} (${network.chainId})`;
                    
                    // Contract instance create करें
                    contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                    
                    // UI update करें
                    document.getElementById('walletAddress').textContent = 
                        userAddress.substring(0, 6) + '...' + userAddress.substring(38);
                    
                    connectBtn.textContent = 'कनेक्टेड';
                    connectBtn.classList.remove('btn-primary');
                    connectBtn.classList.add('btn-success');
                    
                    showStatus("वॉलेट सफलतापूर्वक कनेक्ट हो गया! अब कॉन्ट्रैक्ट टेस्ट करें।", "success");
                    
                    // Enable test buttons
                    document.getElementById('testAllBtn').disabled = false;
                    document.getElementById('ownerBtn').disabled = false;
                    document.getElementById('pausedBtn').disabled = false;
                    document.getElementById('tokenBtn').disabled = false;
                    document.getElementById('loadStatsBtn').disabled = false;
                    
                } else {
                    showStatus("MetaMask इंस्टॉल नहीं है!", "error");
                }
            } catch (error) {
                console.error("वॉलेट कनेक्शन में त्रुटि:", error);
                showStatus("वॉलेट कनेक्शन में त्रुटि: " + error.message, "error");
                
                const connectBtn = document.getElementById('connectBtn');
                connectBtn.textContent = 'वॉलेट कनेक्ट करें';
                connectBtn.disabled = false;
                
                document.getElementById('lastError').textContent = error.message;
            }
        }

        // Network name helper
        function getNetworkName(chainId) {
            const networks = {
                1: 'Ethereum Mainnet',
                56: 'BSC Mainnet',
                97: 'BSC Testnet',
                137: 'Polygon Mainnet',
                80001: 'Polygon Testnet',
                42161: 'Arbitrum One',
                10: 'Optimism'
            };
            return networks[chainId] || `Unknown Network (${chainId})`;
        }

        // सभी फंक्शन्स टेस्ट करें
        async function testAllFunctions() {
            if (!contract) {
                showStatus("पहले वॉलेट कनेक्ट करें!", "error");
                return;
            }

            try {
                const testBtn = document.getElementById('testAllBtn');
                testBtn.innerHTML = '<span class="loading"></span> टेस्टिंग...';
                testBtn.disabled = true;

                showStatus("सभी फंक्शन्स टेस्ट किए जा रहे हैं...", "success");
                
                // Clear previous results
                document.getElementById('testResults').innerHTML = '';
                
                // Test functions one by one
                await addTestResult("owner()", await testFunction('owner'));
                await addTestResult("paused()", await testFunction('paused'));
                await addTestResult("token()", await testFunction('token'));
                await addTestResult("usdt()", await testFunction('usdt'));
                await addTestResult("minUSDT()", await testFunction('minUSDT'));
                await addTestResult("maxAirdropPerClaim()", await testFunction('maxAirdropPerClaim'));
                await addTestResult("totalAirdropCap()", await testFunction('totalAirdropCap'));
                await addTestResult("totalDistributed()", await testFunction('totalDistributed'));
                await addTestResult("withdrawDelay()", await testFunction('withdrawDelay'));
                
                showStatus("सभी फंक्शन्स टेस्ट complete!", "success");
                
                testBtn.textContent = 'सभी फंक्शन्स टेस्ट करें';
                testBtn.disabled = false;
                
            } catch (error) {
                console.error("फंक्शन्स टेस्ट में त्रुटि:", error);
                showStatus("टेस्टिंग में त्रुटि: " + error.message, "error");
                document.getElementById('lastError').textContent = error.message;
                
                const testBtn = document.getElementById('testAllBtn');
                testBtn.textContent = 'सभी फंक्शन्स टेस्ट करें';
                testBtn.disabled = false;
            }
        }

        // Individual function test
        async function testFunction(functionName) {
            try {
                const result = await contract[functionName]();
                return {
                    success: true,
                    result: result.toString(),
                    error: null
                };
            } catch (error) {
                return {
                    success: false,
                    result: null,
                    error: error.message
                };
            }
        }

        // Add test result to UI
        function addTestResult(functionName, testResult) {
            const resultsDiv = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${testResult.success ? 'test-success' : 'test-error'}`;
            
            if (testResult.success) {
                resultDiv.innerHTML = `
                    <strong>${functionName}</strong>: ✅ SUCCESS
                    <div style="font-size: 11px; margin-top: 5px;">Result: ${testResult.result}</div>
                `;
            } else {
                resultDiv.innerHTML = `
                    <strong>${functionName}</strong>: ❌ FAILED
                    <div style="font-size: 11px; margin-top: 5px; color: #dc3545;">Error: ${testResult.error}</div>
                `;
            }
            
            resultsDiv.appendChild(resultDiv);
        }

        // Individual function tests
        async function getOwner() {
            try {
                const result = await testFunction('owner');
                if (result.success) {
                    document.getElementById('basicOwner').innerHTML = 
                        `${result.result} <span style="color: green;">✓</span>`;
                    document.getElementById('debugOwner').textContent = result.result;
                } else {
                    document.getElementById('basicOwner').textContent = 'Error: ' + result.error;
                }
            } catch (error) {
                document.getElementById('basicOwner').textContent = 'Error: ' + error.message;
            }
        }

        async function getPaused() {
            try {
                const result = await testFunction('paused');
                if (result.success) {
                    document.getElementById('basicPaused').textContent = 
                        result.result === 'true' ? 'हाँ ✅' : 'नहीं ❌';
                } else {
                    document.getElementById('basicPaused').textContent = 'Error: ' + result.error;
                }
            } catch (error) {
                document.getElementById('basicPaused').textContent = 'Error: ' + error.message;
            }
        }

        async function getTokenAddress() {
            try {
                const result = await testFunction('token');
                if (result.success) {
                    document.getElementById('basicToken').textContent = result.result;
                    document.getElementById('lastError').textContent = 'कोई एरर नहीं';
                    showStatus("टोकन एड्रेस सफलतापूर्वक लोड हो गया!", "success");
                    return result.result;
                } else {
                    document.getElementById('basicToken').textContent = 'Error: ' + result.error;
                    document.getElementById('lastError').textContent = result.error;
                    showStatus("टोकन एड्रेस लोड नहीं हो पाया", "error");
                    return null;
                }
            } catch (error) {
                document.getElementById('basicToken').textContent = 'Error: ' + error.message;
            }
        }

        // पुराना स्टेटस लोड फंक्शन
        async function loadContractStats() {
            if (!contract) {
                showStatus("पहले वॉलेट कनेक्ट करें!", "error");
                return;
            }
            showStatus("स्टेटस लोड हो रहा है...", "success");
            await testAllFunctions();
        }

        // स्टेटस मैसेज दिखाएं
        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        function showComingSoon() {
            showStatus("यह फीचर जल्द ही उपलब्ध होगा। पहले बेसिक कनेक्शन टेस्ट करें।", "warning");
        }

        function resetUI() {
            document.getElementById('connectBtn').textContent = 'वॉलेट कनेक्ट करें';
            document.getElementById('connectBtn').className = 'btn btn-primary';
            document.getElementById('connectBtn').disabled = false;
            document.getElementById('walletAddress').textContent = 'कनेक्ट नहीं किया गया';
            document.getElementById('networkInfo').textContent = 'अज्ञात';
            
            // Disable all buttons
            document.getElementById('testAllBtn').disabled = true;
            document.getElementById('ownerBtn').disabled = true;
            document.getElementById('pausedBtn').disabled = true;
            document.getElementById('tokenBtn').disabled = true;
            document.getElementById('loadStatsBtn').disabled = true;
            
            document.getElementById('testResults').innerHTML = '';
            document.getElementById('lastError').textContent = 'कोई एरर नहीं';
            showStatus("UI रीसेट हो गया। नया कनेक्शन try करें।", "success");
        }

        // Event Listeners Setup
        function setupEventListeners() {
            document.getElementById('connectBtn').addEventListener('click', connectWallet);
            document.getElementById('testAllBtn').addEventListener('click', testAllFunctions);
            document.getElementById('ownerBtn').addEventListener('click', getOwner);
            document.getElementById('pausedBtn').addEventListener('click', getPaused);
            document.getElementById('tokenBtn').addEventListener('click', getTokenAddress);
            document.getElementById('loadStatsBtn').addEventListener('click', loadContractStats);
            document.getElementById('resetBtn').addEventListener('click', resetUI);
            document.getElementById('depositBtn').addEventListener('click', showComingSoon);
            document.getElementById('withdrawBtn').addEventListener('click', showComingSoon);
            document.getElementById('settingsBtn').addEventListener('click', showComingSoon);
        }

        // Auto connect on page load
        async function autoConnect() {
            console.log('Page loaded, checking for existing connection...');
            if (window.ethereum) {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                    if (accounts.length > 0) {
                        console.log('Auto-connecting wallet...');
                        await connectWallet();
                    }
                } catch (error) {
                    console.log('Auto-connect failed:', error);
                }
            }
        }

        // Network change listener
        function setupNetworkListeners() {
            if (window.ethereum) {
                window.ethereum.on('chainChanged', (chainId) => {
                    console.log('Network changed:', chainId);
                    showStatus("नेटवर्क बदल गया है। पेज रीलोड हो रहा है...", "warning");
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                });

                window.ethereum.on('accountsChanged', (accounts) => {
                    console.log('Account changed:', accounts);
                    showStatus("वॉलेट अकाउंट बदल गया है। पेज रीलोड हो रहा है...", "warning");
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                });
            }
        }

        // Initialize the application
        function initApp() {
            console.log('Initializing application...');
            setupEventListeners();
            setupNetworkListeners();
            
            // Disable all buttons initially
            document.getElementById('testAllBtn').disabled = true;
            document.getElementById('ownerBtn').disabled = true;
            document.getElementById('pausedBtn').disabled = true;
            document.getElementById('tokenBtn').disabled = true;
            document.getElementById('loadStatsBtn').disabled = true;
            
            // Try auto-connect
            autoConnect();
        }

        // Start the app when page loads
        window.addEventListener('load', initApp);
    </script>
</body>
</html>
